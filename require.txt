基于 Waku 的“加密聊天”封装（单聊/群聊/撤回删除）
1. 背景与目标
Waku 是一组模块化的去中心化 P2P 通信协议族，用于隐私友好消息传输。 
 本课题希望候选人基于 Waku（推荐用 JS/TS SDK：@waku/sdk）封装一个“最小可用”的聊天层。 
必须实现：
- 两个用户的单聊
- 多个用户的群聊
- 消息删除与撤回（注意：去中心化网络通常无法真正“从网络中抹除”已传播消息，通常做法是发“撤回/墓碑”控制消息让客户端隐藏）——要求候选人在设计文档中说明这一点并实现可验证的方案。
2. 范围
In Scope（必需）
- 封装一个 Chat SDK（库）+ 一个最小 Demo（CLI 和 Web 页面都必须）
- 基于 Waku 的发布/订阅：
  - 可用 Relay 或 Light Push + Filter（轻节点场景） 
- Topic 规划：pubsub topic + content topic 的使用说明 
- 消息格式定义（JSON/Protobuf均可；需要明确字段与版本）
- 加密：明确使用哪一层做加密（Waku Message 的 payload 版本 2 提到可按 WAKU2-NOISE 等方式编码/加密；候选人需解释其选择） 
In Scope（同样必需）
- 完整的 IM 产品（好友系统、离线推送、文件传输、语音视频）
- 复杂的反垃圾/反女巫（基本限流与错误处理）
3. 关键概念要求（候选人必须在文档中说明）
- pubsub topic（路由层）与 content topic（应用层标识）区别与用法 
- 为什么选择 Relay 或 LightPush/Filter（轻节点） 
- 消息唯一标识：可使用 Waku 定义的 message hash（SDK里有 messageHash）或你自定义方案，并解释可追溯性 
- “撤回/删除”在去中心化网络中的现实边界：无法强制所有节点删除，只能通过控制消息与本地策略实现“逻辑删除”
4. 功能需求（Functional Requirements）
FR1. 身份与会话
- 每个用户有一个可持久化的身份（keypair/peerId/自定义ID皆可，但要解释）
- 支持创建/加入：
  - 单聊会话（1:1）
  - 群聊会话（N:N）
FR2. 发送与接收
- sendMessage(conversationId, plaintext) → 发送并返回 messageId
- subscribe(conversationId, handler) → 接收消息回调
- 需要基本重试/超时/错误提示
FR3. 历史消息
- 使用 Store 节点拉取历史（支持 Store）
FR4. 删除与撤回（必须做）
 需要同时支持两类行为：
- 删除（本地删除）：用户自己设备不再显示这条消息
- 撤回（面向会话参与者）：发送一个“revoke/tombstone”控制消息，其他客户端收到后把对应 messageId 标记为“已撤回”并隐藏/替换显示
 要求：
- 撤回必须可验证：控制消息包含被撤回 messageId，且需鉴权（只有原发送者或管理员能撤回）
- 解释“无法保证所有节点都真正删除”的原因与边界
FR5. 基本安全
- 消息至少做到机密性（密文传输/存储）与完整性（防篡改/签名或MAC）
- 明确密钥交换/会话密钥生成策略（可简化，但必须自洽、可复现）
- 如果使用 Waku payload 相关加密方案，需引用规范并说明你实现了哪一部分 
FR6. 可运行的本地网络/测试环境
- 提供一键启动的本地环境（例如用 @waku/run 启动本地 nwaku 节点） 
- 提供至少 2 用户 + 1 群组的演示脚本/步骤
5. 交付物（Deliverables）
1. Chat SDK（库）代码 + Demo（CLI、Web都必需）
2. README（本地启动、运行、演示脚本）
3. docs/design.md：协议封装设计、topic 规划、安全方案、撤回删除边界说明
4. 自动化单元测试：至少包含
  - 单聊互发
  - 群聊广播
  - 撤回后各端一致显示
5. 演示视频：2人单聊、3人群聊、撤回与删除演示
6. 复盘清单：候选人能现场解释 Waku topic、消息格式、撤回机制
8. 验收标准（Acceptance Criteria）
- 本地一键启动后，至少两个实例互相单聊成功
- 至少三个实例加入同一群聊，广播消息所有端可见
- 撤回：A 发送消息 → A 发撤回 → B/C 收到后对该 messageId 显示“已撤回/隐藏”
- 删除：本地删除不影响其他端
- 文档清楚说明 Waku 的 topic 概念与选择依据 
9. 必修项清单（必须做到）
-  Chat SDK 封装（init、send、subscribe、join/leave等等等等）
-  单聊 + 群聊
-  撤回（tombstone 控制消息）+ 本地删除
-  消息加密与完整性保护（能解释、能跑） 
-  一键启动本地测试网络/环境 
-  文档 + 自动化测试 + 演示视频
10. 其他（同样必须做到）
- 历史消息：接入 Store 拉取
- 轻节点模式：LightPush + Filter（资源受限场景） 
- 可靠通道/去重：基于 messageId 去重、ACK/重发（可参考 Waku 可靠通道相关思路） 
- 权限模型：群管理员可撤回他人消息（需说明）